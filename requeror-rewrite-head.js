// Generated by CoffeeScript 1.7.1
var a_map, count, drop, dropr, emp, find_splitter_idx, inc, index_of, map, mk_statement, read_deps_names, read_local_names, rewrite_head, slice, str_join, str_split, tail, tailr, take;

emp = require('f-empower');

a_map = emp.a_map, count = emp.count, drop = emp.drop, inc = emp.inc, index_of = emp.index_of, map = emp.map, slice = emp.slice, str_join = emp.str_join, str_split = emp.str_split, tail = emp.tail, take = emp.take;

dropr = function(items_to_drop, arr) {
  return slice(arr, 0, Math.max((count(arr)) - items_to_drop, 0));
};

tailr = function(chars_to_drop, str) {
  return str.substr(0, Math.max((count(str)) - chars_to_drop, 0));
};

find_splitter_idx = function(lines) {
  return index_of('], (', lines);
};

read_deps_names = function(deps_lines) {
  var fmt_dep;
  fmt_dep = function(dep_line) {
    return tailr(1, tail(3, dep_line));
  };
  return a_map(deps_lines, fmt_dep);
};

read_local_names = function(local_names) {
  var fmt_local;
  fmt_local = function(local_line) {
    return tail(2, local_line);
  };
  return a_map(local_names, fmt_local);
};

mk_statement = function(var_name, dep_path) {
  return "" + var_name + " = require \"" + dep_path + "\"";
};

rewrite_head = function(amd_source_lines) {
  var deps, deps_lines, lines, locals, locals_lines, require_statements, splitter_idx;
  lines = dropr(1, drop(1, amd_source_lines));
  splitter_idx = find_splitter_idx(lines);
  deps_lines = take(splitter_idx, lines);
  locals_lines = drop(inc(splitter_idx), lines);
  deps = read_deps_names(deps_lines);
  locals = read_local_names(locals_lines);
  return require_statements = map(mk_statement, locals, deps);
};

module.exports = rewrite_head;
